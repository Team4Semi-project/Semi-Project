<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper
	namespace="kr.co.lemona.board.model.mapper.DefaultBoardMapper">

	<!-- 
		resultMap 사용 이유 Board 하나에 Comment가 여러 개 있는 경우, 
		<id>가 없으면 MyBatis가 같은 Board를 다른 객체로 오인해서 
		중복 객체를 생성할 수 있음. 
	-->
	<resultMap type="Board" id="board_rm">

		<id property="boardNo" column="BOARD_NO" />

		<!-- 해당 게시글 댓글 목록 조회 후 필드에 저장 -->
		<collection property="commentList"
			select="selectCommentList" column="BOARD_NO"
			javaType="java.util.ArrayList" ofType="Comment" />

	</resultMap>



	<!-- 게시글 상세 조회 -->
	<select id="selectOne" > <!-- resultMap="board_rm" 댓글 구현 후 추가해야함 -->
		SELECT BOARD_NO, BOARD_TITLE,
		BOARD_CONTENT, BOARD_CODE, READ_COUNT,
		MEMBER_NO, MEMBER_NICKNAME,
		PROFILE_IMG,
		TO_CHAR(BOARD_CREATE_DATE, 'YYYY"년" MM"월" DD"일"
		HH24:MI:SS') BOARD_CREATE_DATE,
		TO_CHAR(BOARD_UPDATE_DATE, 'YYYY"년"
		MM"월" DD"일"
		HH24:MI:SS') BOARD_UPDATE_DATE,

		(SELECT COUNT(*)
		FROM
		"DEFAULT_BOARD_LIKE"
		WHERE BOARD_NO =
		#{boardNo}) LIKE_COUNT,

		(SELECT
		COUNT(*)
		FROM "DEFAULT_BOARD_LIKE"
		WHERE BOARD_NO =
		#{boardNo}
		AND MEMBER_NO =
		#{memberNo}) LIKE_CHECK

		FROM "BOARD"
		JOIN
		"MEMBER"
		USING(MEMBER_NO)
		WHERE
		BOARD_DEL_FL = 'N'
		AND BOARD_NO =
		#{boardNo}
		AND
		BOARD_CODE =
		#{boardCode}
	</select>
</mapper>