<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper
	namespace="kr.co.lemona.main.model.mapper.MainMapper">

	<select id="mainRecipeBoardList" resultType="Map">
		SELECT *
		FROM (
		SELECT
		B.BOARD_NO,
		B.BOARD_TITLE,
		B.READ_COUNT,
		M.MEMBER_NICKNAME,

		-- 댓글 수
		(SELECT COUNT(*)
		FROM RECIPE_COMMENT C
		WHERE C.BOARD_NO = B.BOARD_NO) AS COMMENT_COUNT,

		-- 좋아요 수
		(SELECT COUNT(*)
		FROM RECIPE_BOARD_LIKE L
		WHERE L.BOARD_NO = B.BOARD_NO) AS LIKE_COUNT,

      <![CDATA[
      CASE
        WHEN SYSDATE - B.BOARD_CREATE_DATE < 1 / 24 / 60 
        THEN FLOOR((SYSDATE - B.BOARD_CREATE_DATE) * 24 * 60 * 60) || '초 전'

        WHEN SYSDATE - B.BOARD_CREATE_DATE < 1 / 24 
        THEN FLOOR((SYSDATE - B.BOARD_CREATE_DATE) * 24 * 60) || '분 전'

        WHEN SYSDATE - B.BOARD_CREATE_DATE < 1 
        THEN FLOOR((SYSDATE - B.BOARD_CREATE_DATE) * 24) || '시간 전'

        ELSE TO_CHAR(B.BOARD_CREATE_DATE, 'YYYY-MM-DD')
      END
      ]]>
		AS BOARD_CREATE_DATE

		FROM RECIPE_BOARD B
		JOIN MEMBER M ON B.MEMBER_NO = M.MEMBER_NO
		WHERE B.BOARD_DEL_FL = 'N'
		ORDER BY B.BOARD_NO DESC
		)
		WHERE <![CDATA[ ROWNUM <= 4 ]]>

	</select>

	

</mapper>
